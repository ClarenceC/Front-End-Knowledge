## 跨域

跨域不是只是前端单方面解决的问题，前端有解决跨域的方案，后端也有跨域的方案，不管是怎样解决，都需要服务端的支持的。


### 什么是同源策略

> 同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。 ——MDN

同源策略一开始是由 Netscape 引入浏览器的，主要是为了保证用户信息安全和防止恶意的网站窃取数据。如果在另一个域名下能能请求我们域名网页面的信息就会出现安全性问题，比如信息会泄漏，浏览器受到 xss、 CSFR等攻击。 如果是恶意代码就会更加造成不必要的损性。所以同源策略就会默认从自己同一个域名下请求文件才是安全可信的。


那怎样是同源呢:

- 网络访问协议相同比如同是 https.

- 域名相同，域名相同是指完全相同，主域名相同子域名不同,或者二级域名和主机域名不相同，都是不符合的.

- 端口相同

符合上面三个条件才符合同策略。"同源策略" 在将来可能会越来越严格，如果不满足同源策略，会有那些限制呢:

- Cookie、 LocalStorage 和 IndexDB 无法读取.

- DOM 无法获得.

- AJAX 请求不能发送。


如果项目环境或者实际情况限制不得不同源，又需要实现数据通讯这时候就需要跨域了。

### 什么是跨域

什么是跨域，跨域就是指当在项目或者页面不同源的情况下，需要请求另一个域下的资源和沟通交互信息。

### 解决跨域的办法

#### 1. JSONP

HTML 为了减轻一些静态资源标签的加载是默认没有跨域限制的比如: `<script> <img> <link> <canvas> <video>`，JSONP 原理就是里利用这个漏洞，会在本域名下创建一个动态的 `<script>`脚本, 指向跨域第三方的Api 并返回一个 JSON 数据包, 再利用本域名脚本的回调接收解析 JSON 数据。

```js
  var script = document.createElement('script')

  script.type = 'text/javascript'

  script.src = 'http://localhost:3000/action?user=Clarence&callback=handleCallback'

  document.body.appendChild(script)

  function handleCallback(res) {
    console.log(JSON.stringify(res)) // 解析 JSON 格式
  }
```

一些其它 Jquery 等的库都有对 JSONP 有封装，能快速实现。

JSONP 因为是基于标签加载没限制的bug，所以只支持简单 GET 请求，不支持POST 等其它请求。


#### 1. document.domain + iframe 跨域

#### 1. window.name + iframe 跨域

#### 1. location.hash + iframe 跨域

#### 1. postMessage 跨域

#### 1. CORS 跨域资源共享



### 参考引用

[浏览器同源政策及其规避方法——阮一峰](https://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html)

[浏览器的同源策略——MDN](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)

[JSONP 的工作原理是什么？](https://www.zhihu.com/question/19966531)

